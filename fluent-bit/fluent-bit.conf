[SERVICE]
    Flush        1
    Daemon       Off
    Log_Level    info
    Parsers_File /fluent-bit/etc/parsers.conf # Use absolute path
    # Enable HTTP Server for monitoring Fluent Bit itself (optional)
    HTTP_Server  On
    HTTP_Listen  0.0.0.0
    HTTP_Port    2020

# Input definitions for Syslog sources
[INPUT]
    Name        syslog
    Tag         syslog.tcp
    Listen      0.0.0.0
    Port        5514
    Mode        tcp
    Parser      syslog-rfc5424 # Assuming RFC5424 is preferred, adjust if needed

[INPUT]
    Name        syslog
    Tag         syslog.udp
    Listen      0.0.0.0
    Port        5514
    Mode        udp
    Parser      syslog-rfc5424 # Assuming RFC5424 is preferred, adjust if needed

# Filters for processing Syslog inputs and mapping to OCSF
[FILTER]
    Name    modify
    Match   syslog.*
    Rename  timestamp time

[FILTER]
    Name    nest
    Match   syslog.*
    Operation nest
    Wildcard hostname
    Nest_under observer
    # Remove_prefix hostname # Optional

[FILTER]
    Name    modify
    Match   syslog.*
    Add     category_uid 1
    Add     class_uid 0
    Add     metadata.product.name SIEMBox-FluentBit-Collector
    Add     metadata.product.vendor_name SIEMBox
    Add     metadata.version 1.0
    # Add     severity_id 0 # Default: Unknown
    # Add     status_id 1 # Default: Success

# Define Outputs
[OUTPUT]
    Name        http
    Match       * # Match all tags for now
    Host        api # Service name of the main API
    Port        8080
    URI         /api/logs # Endpoint on the main API service
    Format      json # Send logs as JSON payload
    Json_Date_Key timestamp # Use 'timestamp' field for the date
    Json_Date_Format iso8601 # Format timestamp as ISO8601
    Retry_Limit 5 # Retry sending failed chunks