[SERVICE]
    flush        1
    daemon       off
    log_level    debug
    parsers_file /fluent-bit/etc/parsers.conf
    # Enable HTTP Server for monitoring Fluent Bit itself (optional)
    http_server  on
    http_listen  0.0.0.0
    http_port    2020

# Input definitions for Syslog sources
[INPUT]
    name        syslog
    tag         syslog.tcp
    listen      0.0.0.0
    port        5514
    mode        tcp
    parser      syslog-flexible

[INPUT]
    name        syslog
    tag         syslog.udp
    listen      0.0.0.0
    port        5514
    mode        udp
    parser      syslog-flexible

# Format logs to match API expectations exactly
[FILTER]
    name    lua
    match   syslog.*
    script  /fluent-bit/etc/format_logs.lua
    call    reformat

# Add a debug output to see what's being processed
[OUTPUT]
    name        stdout
    match       syslog.*
    format      json_lines

# Define Outputs - Use the exact format that works with the API
[OUTPUT]
    name        http
    match       syslog.*
    host        api
    port        8080
    uri         /api/logs
    format      json
    json_date_format iso8601
    tls         off
    
    # Retry settings (supported parameters)
    retry_limit 10
    
    # Headers and logging
    header      Content-Type application/json
    log_response_payload On
    header      Content-Type application/json